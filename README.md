# CanOpen_STM_Main

## **Update Log**
### **2022.03.22**

**[1차 완성 - MIFE 실험] 커밋**

- 잘 구동됨 -> 이걸로 MIFE 자유도 실험 진행했었음.

>>
extern int32_t DesiredValuePreset_M1[20] = {0,190000,0,0,190000,0,0,190000,0,0,190000,0,0,190000,0,0,190000,0,0,190000};
extern int32_t DesiredValuePreset_M2[20] = {10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000};
extern int32_t DesiredValuePreset_M3[20] = {5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000};
extern int32_t DesiredValuePreset_M4[20] = {0,0,0,18000,0,0,18000,0,0,18000,0,0,18000,0,0,18000,0,0,18000,0};

**[1차 완성 - TFE 실험] 커밋**

- 잘 구동됨 -> 이걸로 TFE 자유도 실험 진행했었음.
- TFE 자유도가 조금 적게 나오는데 아마 구동기 stroke때문일지도..
- 이때 사용된 preset은 아래와 같음. 복사 붙여넣기 하면 됨.

>>
extern int32_t DesiredValuePreset_M1[20] = {0,160000,0,0,160000,0,0,160000,0,0,160000,0,0,160000,0,0,160000,0,0,160000};
extern int32_t DesiredValuePreset_M2[20] = {0,0,0,9000,0,0,9000,0,0,9000,0,0,9000,0,0,9000,0,0,9000,0};
extern int32_t DesiredValuePreset_M3[20] = {5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000};
extern int32_t DesiredValuePreset_M4[20] = {16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000,16000};



**[1차 완성 - TABD 실험] 커밋**

- 잘 구동됨 -> 이걸로 TABD 자유도 실험 진행했었음.
- 이때 사용된 preset은 아래와 같음. 복사 붙여넣기 하면 됨.

>>
extern int32_t DesiredValuePreset_M1[20] = {50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000,50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000, 50000};
extern int32_t DesiredValuePreset_M2[20] = {0, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0};
extern int32_t DesiredValuePreset_M3[20] = {0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000, 0, 10000};
extern int32_t DesiredValuePreset_M4[20] = {12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000,12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000};

- motor_ struct에 DESIRED크기가 10으로 설정되어서 메모리 침범해서 생긴 문제였음 (아래 문제는) -> 해결함.

**[1차 완성] 커밋**

- 잘 구동되는 상태 중간 저장
- 다만 이상하게 desired들 크기를 10->20으로 하니까 conv_flag가 1,1,1,0으로 마지막값이 수렴 안했다고 떠서 수정이 필요해 보임.


**[CAN_Check_Convergence 함수 변경] 커밋**

- Admittance일때는 Motor Data가 아닌 Loadcell data의 error값으로 수렴 여부를 반환하도록 변경함.

**[ConvFlag추가2] 커밋**

- 모터드라이버 4번에 원하는 값 들어가는건 해결 (아래 커밋을 통해)
- j가 안들어가는 이유는 PDOStatus가 너무 빨리 바뀌는거라 ConvFlag 변수 이용해서 해결해보려 함.
- PDO convergence를 PDOStatus로 output을 주지않고 ConvFlag로 output을 두어 해결해봄.
- ConvFlag로 해결가능함을 확인했음. (ConfFlag추가2)
- j가 주어진 값보다 크면 문제가 될 수 있어서 코드로 해결함. (ConfFlag추가2)

**[CAN_SendDesiredValue함수수정3] 커밋**

- CAN_SendDesiredValue함수 내에서 CAN_SendPDO가 Node가 Node-1이 되어있어서 Node4에 값이 포함안되던 문제 해결
- 아마 밑에 있는 모터드라이버 4번에 원하는 값이 안들어가는 문제가 해결되지 않을까?
- 변수 잘못 적은거 수정해서 뒤에 2 붙임 (DesiredValuePreset_M4)
- 변수 잘못 적은거 수정해서 뒤에 3 붙임, 일단 4번에 원하는 값이 들어가지만 j가 증가하지않음을 확인.

**[Con_ModePresetM# 추가] 커밋**

- 각 모터 드라이버에 다른 ConMode, DesiredValue 배열이 입력되도록 변경.
- j=1커밋에서 모터드라이버 4번에만 원하는 값이 들어가지 않음을 확인함.

**[j=1일때 if문 예외 추가] 커밋**

- j=1일때 CON_Mode와 CON_Mode_Prev가 같아서 CON_Mode가 제대로 설정 안되던 문제 해결
- 아직 [2022_0321_다시짠코드_연속적으로TargetValue갈수있도록] 커밋 검증은 안됐음. 

### **2022.03.21**

**[2022_0321_다시짠코드_연속적으로TargetValue갈수있도록] 커밋**

- 아직 검증이 안됐음.
- Target Value를 배열로 입력하면 그 값들 차근차근 갈수 있도록 짰는데 확인이 필요함.

**[ControlModePreset/DesiredForcePreset/DesiredValuePreset추가2] 커밋**

- Target값들을 그냥 선언하면 안되고 memcpy로 해야하는 것 같아서 memcpy로 작성
- memcpy(&motor_[i].Con_Mode[0], &Con_ModePreset[0], 40); 이런식으로 짬.

**[220321_기존 실험 코드 업로드] 커밋**

- 지난 실험에서 검증이 됐는데 Target Value를 하나만 갈수 있도록 해서 위에 수정 새로 했음. -> 검증하고 파기하면 될 것 같음.


-----------

